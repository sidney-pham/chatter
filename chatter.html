<head>
    <title>Chatter</title>
</head>

<template name="main">
    {{> yield}}
    <hr>
    <p>Sidney Pham</p>
</template>

<template name="home">
    {{#if currentUser}}
        {{> app}}    
    {{else}}
        {{> notLoggedIn}}
    {{/if}}

</template>

<template name="app">
    <h1>LOGGED IN YO!</h1>
    <a href="#" class="logout">Logout</a>

    <ul>
        <img src="{{getProfilePicture user._id}}" alt="{{user.profile.name}}" class="profilePicture">
        <li>Name: {{user.profile.name}}</li> <!-- This is relies on profile property existing -->
        <li>Email: {{user.services.facebook.email}}</li>
        <li>Gender: {{user.services.facebook.gender}}</li>
    </ul>

    {{> addFriends}}

    {{> chatWindow}}
</template>

<template name="addFriends">
    {{#if friendsToAdd}}
        <h2>Here are some friends to add:</h2>
        <ul>
            {{#each friendsToAdd}}
                <img src="{{getProfilePicture _id}}" alt="{{profile.name}}" class="profilePicture">
                <li>
                    <label>
                        <input type="checkbox" class="addFriendCheckbox">
                        {{profile.name}}
                    </label>
                </li>
            {{/each}}
        </ul>
    {{/if}}
</template>

<!-- Should break this down into sub-templates -->
<template name="chatWindow">
    <div class="friendsList">
        {{#if friends}}
            <h2>Here are your friends: </h2>
            <ul>
                {{#each friends}}
                    <li>
                        <a href="#" class="friend {{selected}}">{{profile.name}}</a>
                        <a href="#" class="removeFriend">[-]</a>
                    </li> 
                {{/each}} 
            </ul>
        {{/if}}
    </div>
    {{#if friends}}
        {{#if friendSelected}}
            <div class="chatHeader">
                <h2>{{chattingWith.profile.name}}</h2>
            </div>
            <div class="chatMessages">
                <ul>
                    {{#each messages}}  
                        <li>
                            <h5>{{fromWhom from}} said:</h5>
                            <h6 class="sentAt">at {{formatTime sentAt}}</h6>
                            <p>{{text}}</p>
                        </li>
                    {{/each}}
                </ul>
            </div>
            <div class="chatBottom">
                <input type="text" placeholder="Type a message:" name="message">
            </div>
        {{else}}
            <div class="chatHeader">
                <h2>Select a friend to chat with!</h2>
            </div>
            <div class="chatMessages">
                <h4>To start chatting, select a friend!</h4>
            </div>
        {{/if}}
    {{else}}
        {{#if otherUsersExist}}
            <div class="chatHeader">
                <h2>You need to add some friends first!</h2>
            </div>
            <div class="chatMessages">
                <h4>To start chatting, add a friend!</h4>
            </div>
        {{else}}
            <div class="chatHeader">
                <h2>No users exist!</h2>
            </div>
            <div class="chatMessages">
                <h4>Tell a friend about Chatter to chat with them!</h4>
            </div>
        {{/if}}
    {{/if}}
</template>

<template name="notLoggedIn">
    <h1>Chatter!</h1>
    <p>Chat with all your friends!</p>
    
    {{#if socialLoginConfigured}}
        {{> facebookLogin}}
    {{else}}
        <p>Social login not configured yet.</p>
    {{/if}}
</template>

<template name="facebookLogin">
    <button class="fbLogin">Log in with Facebook!</button>
</template>